dependencies:
  pre:
    - bash ./scripts/install-nix.sh
  override:
    - make install-deps
  cache_directories:
    - "/nix"
    - "~/.nix-defexpr"
    - "~/.nix-channels"
    - "~/.nix-profile"

machine:
  pre:
    - sudo mkdir -p -m 0755 /nix
    - sudo chown $USER /nix
    - echo ". $HOME/.nix-profile/etc/profile.d/nix.sh" >> ~/.bashrc

test:
  override:
    - make test

deployment:
  testing:
    branch: deployment
    commands:
      - bash ./scripts/deploy.sh $(readlink result)
