machine:
  pre:
    - make -C $HOME/$CIRCLE_PROJECT_REPONAME configure-nix

dependencies:
  cache_directories:
    - "/nix"
    - "~/.nix-defexpr"
    - "~/.nix-channels"
    - "~/.nix-profile"
  pre:
    - make install-nix
  override:
    - make install-deps

test:
  override:
    - make test

deployment:
  testing:
    branch: deployment
    commands:
      - make deploy
